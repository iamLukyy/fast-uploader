# For use with Traefik reverse proxy
# Usage: docker compose -f docker-compose.traefik.yml up -d

services:
  fast-uploader:
    build: .
    container_name: fast-uploader
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      - NUXT_SESSION_SECRET=${NUXT_SESSION_SECRET}
      - NUXT_AUTH_PASSWORD=${NUXT_AUTH_PASSWORD}
      - NUXT_PUBLIC_BASE_URL=${NUXT_PUBLIC_BASE_URL:-}
      - NUXT_DATA_DIR=/data
    volumes:
      - uploader-data:/data
    networks:
      - traefik
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.fast-uploader.rule=Host(`${DOMAIN}`)"
      - "traefik.http.routers.fast-uploader.entrypoints=websecure"
      - "traefik.http.routers.fast-uploader.tls=true"
      - "traefik.http.routers.fast-uploader.tls.certresolver=letsencrypt"
      - "traefik.http.services.fast-uploader.loadbalancer.server.port=3000"

volumes:
  uploader-data:

networks:
  traefik:
    external: true
